////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
// Created: 25.11.2023
// Author: Deathman
// Nocturning studio for NS Project X
////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
#include "common.xrh"
#include "gbuffer.xrh"
////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
// Pixel
float4 main (float2 TexCoords: TEXCOORD0): COLOR
{
    float depth = GetPosition (TexCoords).z;
	float4 distort = tex2Dlod0 (s_distort, TexCoords);
	float2 offset = (distort.xy - (127.0f / 255.0f)) * def_distort; // fix newtral offset
	float2 SampleTexCoords = TexCoords + offset;
    float depth_x = GetPosition (SampleTexCoords).z;
    if ((depth_x + EPSDEPTH) < depth)	
        SampleTexCoords = TexCoords; // discard new sample
    
    float3 image = tex2Dlod0 (s_image, SampleTexCoords);
    
    return image.rgbb;
}
////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
