///////////////////////////////////////////////////////////////////////////////////
// Created: 02.12.2023
// Author: Deathman
// Nocturning studio for NS Project X
///////////////////////////////////////////////////////////////////////////////////
#include "common.h"
///////////////////////////////////////////////////////////////////////////////////
uniform vector3 hdr_params;
///////////////////////////////////////////////////////////////////////////////////
vector4 main (vector2 TexCoords: TEXCOORD0): COLOR0
{
    vector3 SceneColor = tex2Dlod0 (s_image, TexCoords);
    
    SceneColor = pow (SceneColor, hdr_params.y);
    
    SceneColor *= hdr_params.z;
    
    const vector fWhiteIntensitySQR = pow (hdr_params.x, 2.0h);

    SceneColor.rgb = vector3 (((SceneColor.rgb * (1.0h + SceneColor.rgb / fWhiteIntensitySQR)) / (SceneColor.rgb + 1.0h)));
    
    return vector4 (SceneColor, 1.0h);
}
///////////////////////////////////////////////////////////////////////////////////