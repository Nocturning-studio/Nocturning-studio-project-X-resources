////////////////////////////////////////////////////////////////////////////
//	Created		: 26.02.2023
//	Author		: Deathman
//  Nocturning studio for NS Project X
////////////////////////////////////////////////////////////////////////////
#ifndef HDR_INCLUDED
#define HDR_INCLUDED
////////////////////////////////////////////////////////////////////////////
#include "common.h"
////////////////////////////////////////////////////////////////////////////
uniform float3 hdr_params;
////////////////////////////////////////////////////////////////////////////
static const float3 luminance_weights = float3(0.2125f, 0.7154f, 0.0721f);
////////////////////////////////////////////////////////////////////////////
float get_luminance(float3 color)
{
    return dot(color, luminance_weights);
}

float3 Calc_hdr(float3 Color)
{
    const float white_level = hdr_params;
    const float luminance_saturation = 1.0f;
    const float pixel_luminance = get_luminance(Color);
    const float tone_mapped_luminance = 1.0f - exp(-pixel_luminance / white_level);

    Color = tone_mapped_luminance * pow(Color / pixel_luminance, luminance_saturation);

    Color = pow(Color, hdr_params.y);

    Color *= hdr_params.z;

    return Color;
}
////////////////////////////////////////////////////////////////////////////
#endif//HDR_INCLUDED
////////////////////////////////////////////////////////////////////////////
