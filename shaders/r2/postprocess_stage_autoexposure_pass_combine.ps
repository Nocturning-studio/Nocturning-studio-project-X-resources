///////////////////////////////////////////////////////////////////////////////////
// Created: 02.12.2023
// Author: Deathman
// Nocturning studio for NS Project X
///////////////////////////////////////////////////////////////////////////////////
#include "common.xrh"
///////////////////////////////////////////////////////////////////////////////////
float4 main (float2 TexCoords: TEXCOORD0): COLOR0
{
    float4 Color = tex2Dlod0 (s_image, TexCoords);
    
    float Exposure = tex2Dlod0 (s_autoexposure, float2 (0.5f, 0.5f)).r;
    
    //return Color * Exposure;//(1.0f - exp(-Color * Exposure)) * Exposure;

    //Exposure *= SceneColor;
    //return Exposure / (Exposure - Color + 1.0f);

    float whitesqr = Exposure * Exposure;
    Color *= Exposure;
    return (Color * (1.0f + Color / whitesqr)) / (Color + 1.0f);
}
///////////////////////////////////////////////////////////////////////////////////